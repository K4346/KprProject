class t{constructor(t){this.charCode=t.CharCode,this.nominal=t.Nominal,this.name=t.Name,this.value=t.Value,this.previous=t.Previous}}class e{constructor(t){this.date=t.Date,this.previousDate=t.PreviousDate,this.previousURL=t.PreviousURL,this.timestamp=t.Timestamp,this.valute=t.Valute}}class n{constructor(t,e,n,o,a){this.fromX=t,this.fromY=e,this.toX=n,this.toY=o,this.amountText=a}}document.addEventListener("DOMContentLoaded",(function(){fetch("https://www.cbr-xml-daily.ru/daily_json.js").then((t=>t.json())).then((n=>{null==l&&(l=new e(n),u(!0),Object.keys(l.valute).forEach((t=>{let e=document.createElement("option");e.value=t,e.innerHTML=t,a.appendChild(e)})),a.addEventListener("change",(e=>{const n=document.getElementById("selectedCurrencyContainer");"-"!==e.target.value?(h=new t(l.valute[a.value]),n.textContent=`Валюта: ${h.name}`,document.getElementById("changesContainer").style.display="block",i.drawArrow([{value:h.previous,date:l.previousDate},{value:h.value,date:l.date}],o)):(document.getElementById("changesContainer").style.display="none",n.textContent="\n",i.clear()),c()})),s.addEventListener("input",(()=>{c()})),function(){const t=o.getCurrenciesByDynamics(Object.values(l.valute));r.draw({increase:t.pros.length,decrease:t.cons.length,equal:t.equal.length});const e=document.getElementById("pros"),n=document.getElementById("cons"),a=document.getElementById("cons");0!==t.pros.length&&(e.textContent=`Валюты с положительной динамикой: ${o.getCurrencyNamesFromArray(t.pros)}`),0!==t.cons.length&&(n.textContent=`Валюты с отрицательной динамикой: ${o.getCurrencyNamesFromArray(t.cons)}`),0!==t.equal.length&&(a.textContent=`Валюты с нулевой динамикой: ${o.getCurrencyNamesFromArray(t.equal)}`)}())})).catch((t=>{u(!1),console.error(t)}))}));const o=new class{formatFloatToDisplayingAmount(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,o=t.toString();for(let t=0;t<o.length;t++)if("."!==o[t]){if(void 0!==e&&(e+=1,e===n))return o.substring(0,t+1)}else if(e=0,e===n)return o.substring(0,t);return o}showNominalCurrency(t,e){if(void 0===t||void 0===e.charCode||void 0===e.nominal)return"";if(e.value<=0||e.nominal<1||!Number.isInteger(t)||t<1)return"";const n=parseFloat(e.value)*t/parseFloat(e.nominal);return`${t.toString()} ${e.charCode} = ${this.formatFloatToDisplayingAmount(n)}₽`}getCurrenciesByDynamics(e){let n=[],o=[],a=[];return e.forEach((e=>{const s=new t(e);s.previous<s.value?n.push(s):s.previous>s.value?o.push(s):a.push(s)})),{pros:n,cons:o,equal:a}}getCurrencyNamesFromArray(t){let e="";for(let n=0;n<t.length;n++)e+=t[n].charCode,n!==t.length-1?e+=", ":e+=".";return e}},a=document.getElementById("currencySelector"),s=document.getElementById("nominalInput"),i=new class{constructor(t){this.canvas=t}clear(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height)}prepareAxesAndAmountForArrow(t,e){let o,a,s=0;const i=Math.abs(e.formatFloatToDisplayingAmount((r=t[0].value-t[1].value,parseFloat(r.toFixed(8)))));var r;return t[0].value===t[1].value?(a=0,o="Не изменилось"):t[0].value<t[1].value?(s=70,a=0,o=`+${i}₽`):(s=0,a=70,o=`-${i}₽`),new n(5,s,75,a,o)}drawArrow(t,e){this.clear();const n=this.prepareAxesAndAmountForArrow(t,e),o=this.canvas.getContext("2d");o.beginPath(),function(t,e,n,o,a){const s=o-e,i=a-n,r=Math.atan2(i,s);t.moveTo(e,n),t.lineTo(o,a),t.lineTo(o-25*Math.cos(r-Math.PI/6),a-25*Math.sin(r-Math.PI/6)),t.moveTo(o,a),t.lineTo(o-25*Math.cos(r+Math.PI/6),a-25*Math.sin(r+Math.PI/6))}(o,n.fromX,n.fromY,n.toX,n.toY),o.font="18px Tahoma",o.fillText(n.amountText,n.toX+5,(n.fromY+n.toY)/2),o.stroke()}}(document.getElementById("arrowCanvas")),r=new class{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.colors=["#3ebe2a","#ff2525","#5485d0"],this.holeSize=.5,this.legend=e}draw(t){let e,n,o,a=0,s=0;for(n in t)e=t[n],a+=e;let i=0;for(n in t)e=t[n],o=2*Math.PI*e/a,r(this.ctx,this.canvas.width/2,this.canvas.height/2,Math.min(this.canvas.width/2,this.canvas.height/2),i,i+o,this.colors[s%this.colors.length]),i+=o,s++;function r(t,e,n,o,a,s,i){t.fillStyle=i,t.beginPath(),t.moveTo(e,n),t.arc(e,n,o,a,s),t.closePath(),t.fill()}this.holeSize&&r(this.ctx,this.canvas.width/2,this.canvas.height/2,this.holeSize*Math.min(this.canvas.width/2,this.canvas.height/2),0,2*Math.PI,"#ffffff"),function(t,s,r,l){i=0;let h=0;for(n in t){if(e=t[n],h+=e,0===e)continue;o=2*Math.PI*e/a;const c=Math.min(s.width/2,s.height/2);let u=s.width/2+c/2*Math.cos(i+o/2),d=s.height/2+c/2*Math.sin(i+o/2);if(l){const t=c*l/2;u=s.width/2+(t+c/2)*Math.cos(i+o/2),d=s.height/2+(t+c/2)*Math.sin(i+o/2)}const m=e;r.fillStyle="white",r.font="18px Tahoma",r.fillText(m,u,d),i+=o}r.fillStyle="black",r.font="22px Tahoma",r.fillText(h.toString(),s.width/2-7,s.height/2+7)}(t,this.canvas,this.ctx,this.holeSize),function(t,e,o){s=0;let a="";for(n in t)0!==t[n]&&(a+="<div><span style='display:inline-block;width:20px;background-color:"+o[s++]+";'>&nbsp;</span> "+n+"</div>");e.innerHTML=a}(t,this.legend,this.colors)}}(document.getElementById("pieCanvas"),document.getElementById("pieLegend"));let l,h;function c(){const t=document.getElementById("output");"-"!==a.value?t.textContent=o.showNominalCurrency(Number(s.value),h):t.textContent=""}function u(t){t?document.getElementById("content").style.display="block":document.getElementById("contentError").style.display="block"}